<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="copyright" title="Copyright" href="../copyright.html" /><link rel="next" title="10.12 导入模块的同时修改模块" href="p12_patching_modules_on_import.html" /><link rel="prev" title="10.10 通过字符串名导入模块" href="p10_import_modules_using_name_given_in_string.html" />

    <!-- Generated with Sphinx 8.1.3 and Furo 2024.08.06 -->
        <title>10.11 通过钩子远程加载模块 - python3-cookbook 3.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">python3-cookbook 3.0.0 documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">python3-cookbook 3.0.0 documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../preface.html">前言</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p01_data_structures_algorithms.html">第一章：数据结构和算法</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 第一章：数据结构和算法</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c01/p01_unpack_sequence_into_separate_variables.html">1.1 将序列分解为单独的变量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p02_unpack_elements_from_iterables.html">1.2 解压可迭代对象赋值给多个变量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p03_keep_last_n_items.html">1.3 保留最后 N 个元素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p04_find_largest_or_smallest_n_items.html">1.4 查找最大或最小的 N 个元素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p05_implement_a_priority_queue.html">1.5 实现一个优先级队列</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p06_map_keys_to_multiple_values_in_dict.html">1.6 字典中的键映射多个值</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p07_keep_dict_in_order.html">1.7 字典排序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p08_calculating_with_dict.html">1.8 字典的运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p09_find_commonalities_in_dicts.html">1.9 查找两字典的相同点</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p10_remove_duplicates_from_seq_order.html">1.10 删除序列相同元素并保持顺序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p11_naming_slice.html">1.11 命名切片</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p12_determine_most_freqently_items_in_seq.html">1.12 序列中出现次数最多的元素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p13_sort_list_of_dicts_by_key.html">1.13 通过某个关键字排序一个字典列表</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p14_sort_objects_without_compare_support.html">1.14 排序不支持原生比较的对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p15_group_records_based_on_field.html">1.15 通过某个字段将记录分组</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p16_filter_sequence_elements.html">1.16 过滤序列元素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p17_extract_subset_of_dict.html">1.17 从字典中提取子集</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p18_map_names_to_sequence_elements.html">1.18 映射名称到序列元素</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p19_transform_and_reduce_data_same_time.html">1.19 转换并同时计算数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c01/p20_combine_multiple_map_to_single_map.html">1.20 合并多个字典或映射</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p02_strings_and_text.html">第二章：字符串和文本</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of 第二章：字符串和文本</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c02/p01_split_string_on_multiple_delimiters.html">2.1 使用多个界定符分割字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p02_match_text_at_start_end.html">2.2 字符串开头或结尾匹配</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p03_match_strings_with_shell_wildcard.html">2.3 用Shell通配符匹配字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p04_match_and_search_text.html">2.4 字符串匹配和搜索</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p05_search_and_replace_text.html">2.5 字符串搜索和替换</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p06_search_replace_case_insensitive.html">2.6 字符串忽略大小写的搜索替换</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p07_specify_regexp_for_shortest_match.html">2.7 最短匹配模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p08_regexp_for_multiline_partterns.html">2.8 多行匹配模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p09_normalize_unicode_text_to_regexp.html">2.9 将Unicode文本标准化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p10_work_with_unicode_in_regexp.html">2.10 在正则式中使用Unicode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p11_strip_unwanted_characters.html">2.11 删除字符串中不需要的字符</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p12_sanitizing_clean_up_text.html">2.12 审查清理文本字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p13_aligning_text_strings.html">2.13 字符串对齐</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p14_combine_and_concatenate_strings.html">2.14 合并拼接字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p15_interpolating_variables_in_strings.html">2.15 字符串中插入变量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p16_reformat_text_to_fixed_number_columns.html">2.16 以指定列宽格式化字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p17_handle_html_xml_in_text.html">2.17 在字符串中处理html和xml</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p18_tokenizing_text.html">2.18 字符串令牌解析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p19_writing_recursive_descent_parser.html">2.19 实现一个简单的递归下降分析器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c02/p20_perform_text_operations_on_byte_string.html">2.20 字节字符串上的字符串操作</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p03_numbers_dates_times.html">第三章：数字日期和时间</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of 第三章：数字日期和时间</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c03/p01_round_number.html">3.1 数字的四舍五入</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p02_accurate_decimal_calculations.html">3.2 执行精确的浮点数运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p03_format_numbers_for_output.html">3.3 数字的格式化输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p04_binary_octal_hexadecimal_int.html">3.4 二八十六进制整数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p05_pack_unpack_large_int_from_bytes.html">3.5 字节到大整数的打包与解包</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p06_complex_math.html">3.6 复数的数学运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p07_infinity_and_nan.html">3.7 无穷大与NaN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p08_calculating_with_fractions.html">3.8 分数运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p09_calculating_with_large_num_arrays.html">3.9 大型数组运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p10_matrix_and_linear_algebra_calculation.html">3.10 矩阵与线性代数运算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p11_pick_things_at_random.html">3.11 随机选择</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p12_convert_days_to_seconds_and_others.html">3.12 基本的日期与时间转换</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p13_determine_last_friday_date.html">3.13 计算上一个周五的日期</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p14_date_range_for_current_month.html">3.14 计算当前月份的日期范围</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p15_convert_strings_into_datetimes.html">3.15 字符串转换为日期</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c03/p16_manipulate_dates_involving_timezone.html">3.16 结合时区的日期操作</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p04_iterators_and_generators.html">第四章：迭代器与生成器</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of 第四章：迭代器与生成器</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c04/p01_manually_consuming_iterator.html">4.1 手动遍历迭代器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p02_delegating_iteration.html">4.2 代理迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p03_create_new_iteration_with_generators.html">4.3 使用生成器创建新的迭代模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p04_implement_iterator_protocol.html">4.4 实现迭代器协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p05_iterating_in_reverse.html">4.5 反向迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p06_define_generator_func_with_extra_state.html">4.6 带有外部状态的生成器函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p07_taking_slice_of_iterator.html">4.7 迭代器切片</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p08_skip_first_part_of_iterable.html">4.8 跳过可迭代对象的开始部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p09_iterate_over_combination_or_permutation.html">4.9 排列组合的迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p10_iterate_over_index_value_pairs_of_sequence.html">4.10 序列上索引值迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p11_iterate_over_multiple_sequences_simultaneously.html">4.11 同时迭代多个序列</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p12_iterate_on_items_in_separate_containers.html">4.12 不同集合上元素的迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p13_create_data_processing_pipelines.html">4.13 创建数据处理管道</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p14_flattening_nested_sequence.html">4.14 展开嵌套的序列</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p15_iterate_in_sorted_order_over_merged_sorted_iterables.html">4.15 顺序迭代合并后的排序迭代对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c04/p16_replace_infinite_while_loops_with_iterator.html">4.16 迭代器代替while无限循环</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p05_files_and_io.html">第五章：文件与IO</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of 第五章：文件与IO</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c05/p01_read_write_text_data.html">5.1 读写文本数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p02_printing_to_file.html">5.2 打印输出至文件中</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p03_print_with_different_separator_or_line_ending.html">5.3 使用其他分隔符或行终止符打印</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p04_read_write_binary_data.html">5.4 读写字节数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p05_write_to_file_not_exist.html">5.5 文件不存在才能写入</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p06_io_operations_on_string.html">5.6 字符串的I/O操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p07_read_write_compressed_datafiles.html">5.7 读写压缩文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p08_iterate_over_fixed_sized_records.html">5.8 固定大小记录的文件迭代</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p09_read_binary_data_into_mutable_buffer.html">5.9 读取二进制数据到可变缓冲区中</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p10_memory_mapping_binary_files.html">5.10 内存映射的二进制文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p11_manipulating_pathnames.html">5.11 文件路径名的操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p12_test_for_the_existence_of_file.html">5.12 测试文件是否存在</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p13_get_directory_listing.html">5.13 获取文件夹中的文件列表</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p14_bypassing_filename_encoding.html">5.14 忽略文件名编码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p15_printing_bad_filenames.html">5.15 打印不合法的文件名</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p16_add_change_encoding_of_already_open_file.html">5.16 增加或改变已打开文件的编码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p17_write_bytes_to_text_file.html">5.17 将字节写入文本文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p18_wrap_existing_file_descriptor_as_file_object.html">5.18 将文件描述符包装成文件对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p19_make_temporary_files_and_directories.html">5.19 创建临时文件和文件夹</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p20_communicating_with_serial_ports.html">5.20 与串行端口的数据通信</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c05/p21_serializing_python_objects.html">5.21 序列化Python对象</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p06_data_encoding_and_process.html">第六章：数据编码和处理</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of 第六章：数据编码和处理</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c06/p01_read_write_csv_data.html">6.1 读写CSV数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p02_read-write_json_data.html">6.2 读写JSON数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p03_parse_simple_xml_data.html">6.3 解析简单的XML数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p04_parse_huge_xml_files_incrementally.html">6.4 增量式解析大型XML文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p05_turning_dictionary_into_xml.html">6.5 将字典转换为XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p06_parse_modify_rewrite_xml.html">6.6 解析和修改XML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p07_parse_xml_documents_with_namespaces.html">6.7 利用命名空间解析XML文档</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p08_interact_with_relational_database.html">6.8 与关系型数据库的交互</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p09_decode_encode_hexadecimal_digits.html">6.9 编码和解码十六进制数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p10_decode_encode_base64.html">6.10 编码解码Base64数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p11_read_write_binary_arrays_of_structures.html">6.11 读写二进制数组数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p12_read_nested_and_variable_sized_binary_structures.html">6.12 读取嵌套和可变长二进制数据</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c06/p13_summarizing_and_perform_statistics.html">6.13 数据的累加与统计操作</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p07_functions.html">第七章：函数</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of 第七章：函数</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c07/p01_functions_that_accept_any_number_arguments.html">7.1 可接受任意数量参数的函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p02_functions_that_only_accept_keyword_arguments.html">7.2 只接受关键字参数的函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p03_attach_informatinal_matadata_to_function_arguments.html">7.3 给函数参数增加元信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p04_return_multiple_values_from_function.html">7.4 返回多个值的函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p05_define_functions_with_default_arguments.html">7.5 定义有默认参数的函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p06_define_anonymous_or_inline_functions.html">7.6 定义匿名或内联函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p07_capturing_variables_in_anonymous_functions.html">7.7 匿名函数捕获变量值</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p08_make_callable_with_fewer_arguments.html">7.8 减少可调用对象的参数个数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p09_replace_single_method_classes_with_functions.html">7.9 将单方法的类转换为函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p10_carry_extra_state_with_callback_functions.html">7.10 带额外状态信息的回调函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p11_inline_callback_functions.html">7.11 内联回调函数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c07/p12_access_variables_defined_inside_closure.html">7.12 访问闭包中定义的变量</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p08_classes_and_objects.html">第八章：类与对象</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of 第八章：类与对象</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c08/p01_change_string_representation_of_instances.html">8.1 改变对象的字符串显示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p02_customizing_string_formatting.html">8.2 自定义字符串的格式化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p03_make_objects_support_context_management_protocol.html">8.3 让对象支持上下文管理协议</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p04_save_memory_when_create_large_number_instances.html">8.4 创建大量对象时节省内存方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p05_encapsulating_names_in_class.html">8.5 在类中封装属性名</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p06_create_managed_attributes.html">8.6 创建可管理的属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p07_calling_method_on_parent_class.html">8.7 调用父类方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p08_extending_property_in_subclass.html">8.8 子类中扩展property</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p09_create_new_kind_of_class_or_instance_attribute.html">8.9 创建新的类或实例属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p10_using_lazily_computed_properties.html">8.10 使用延迟计算属性</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p11_simplify_initialization_of_data_structure.html">8.11 简化数据结构的初始化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p12_define_interface_or_abstract_base_class.html">8.12 定义接口或者抽象基类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p13_implementing_data_model_or_type_system.html">8.13 实现数据模型的类型约束</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p14_implementing_custom_containers.html">8.14 实现自定义容器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p15_delegating_attribute_access.html">8.15 属性的代理访问</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p16_define_more_than_one_constructor_in_class.html">8.16 在类中定义多个构造器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p17_create_instance_without_invoking_init_method.html">8.17 创建不调用init方法的实例</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p18_extending_classes_with_mixins.html">8.18 利用Mixins扩展类功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p19_implements_stateful_objects_or_state_machines.html">8.19 实现状态对象或者状态机</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p20_call_method_on_object_by_string_name.html">8.20 通过字符串调用对象方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p21_implementing_visitor_pattern.html">8.21 实现访问者模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p22_implementing_visitor_pattern_without_recursion.html">8.22 不用递归实现访问者模式</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p23_managing_memory_in_cyclic_data_structures.html">8.23 循环引用数据结构的内存管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p24_making_classes_support_comparison_operations.html">8.24 让类支持比较操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c08/p25_creating_cached_instances.html">8.25 创建缓存实例</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p09_meta_programming.html">第九章：元编程</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of 第九章：元编程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c09/p01_put_wrapper_around_function.html">9.1 在函数上添加包装器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p02_preserve_function_metadata_when_write_decorators.html">9.2 创建装饰器时保留函数元信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p03_unwrapping_decorator.html">9.3 解除一个装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p04_define_decorator_that_takes_arguments.html">9.4 定义一个带参数的装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p05_define_decorator_with_user_adjustable_attributes.html">9.5 可自定义属性的装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p06_define_decorator_that_takes_optional_argument.html">9.6 带可选参数的装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p07_enforcing_type_check_on_function_using_decorator.html">9.7 利用装饰器强制函数上的类型检查</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p08_define_decorators_as_part_of_class.html">9.8 将装饰器定义为类的一部分</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p09_define_decorators_as_classes.html">9.9 将装饰器定义为类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p10_apply_decorators_to_class_and_static_methods.html">9.10 为类和静态方法提供装饰器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p11_write_decorators_that_add_arguments_to_functions.html">9.11 装饰器为被包装函数增加参数</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p12_using_decorators_to_patch_class_definitions.html">9.12 使用装饰器扩充类的功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p13_using_mataclass_to_control_instance_creation.html">9.13 使用元类控制实例的创建</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p14_capture_class_attribute_definition_order.html">9.14 捕获类的属性定义顺序</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p15_define_metaclass_that_takes_optional_arguments.html">9.15 定义有可选参数的元类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p16_enforce_argument_signature_on_args_kwargs.html">9.16 *args和**kwargs的强制参数签名</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p17_enforce_coding_conventions_in_classes.html">9.17 在类上强制使用编程规约</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p18_define_classes_programmatically.html">9.18 以编程方式定义类</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p19_initializing_class_members_at_definition_time.html">9.19 在定义的时候初始化类的成员</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p20_implement_multiple_dispatch_with_function_annotations.html">9.20 利用函数注解实现方法重载</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p21_avoid_repetitive_property_methods.html">9.21 避免重复的属性方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p22_define_context_managers_the_easy_way.html">9.22 定义上下文管理器的简单方法</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p23_executing_code_with_local_side_effects.html">9.23 在局部变量域中执行代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p24_parse_and_analyzing_python_source.html">9.24 解析与分析Python源码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c09/p25_disassembling_python_byte_code.html">9.25 拆解Python字节码</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../chapters/p10_modules_and_packages.html">第十章：模块与包</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of 第十章：模块与包</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="p01_make_hierarchical_package_of_modules.html">10.1 构建一个模块的层级包</a></li>
<li class="toctree-l2"><a class="reference internal" href="p02_control_the_import_of_everything.html">10.2 控制模块被全部导入的内容</a></li>
<li class="toctree-l2"><a class="reference internal" href="p03_import_submodules_by_relative_names.html">10.3 使用相对路径名导入包中子模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="p04_split_module_into_multiple_files.html">10.4 将模块分割成多个文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="p05_separate_directories_import_by_namespace.html">10.5 利用命名空间导入目录分散的代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="p06_reloading_modules.html">10.6 重新加载模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="p07_make_directory_or_zip_runnable_as_main_script.html">10.7 运行目录或压缩文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="p08_read_datafile_within_package.html">10.8 读取位于包中的数据文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="p09_add_directories_to_sys_path.html">10.9 将文件夹加入到sys.path</a></li>
<li class="toctree-l2"><a class="reference internal" href="p10_import_modules_using_name_given_in_string.html">10.10 通过字符串名导入模块</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">10.11 通过钩子远程加载模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="p12_patching_modules_on_import.html">10.12 导入模块的同时修改模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="p13_installing_packages_just_for_yourself.html">10.13 安装私有的包</a></li>
<li class="toctree-l2"><a class="reference internal" href="p14_creating_new_python_environment.html">10.14 创建新的Python环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="p15_distributing_packages.html">10.15 分发包</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p11_network_and_web_program.html">第十一章：网络与Web编程</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of 第十一章：网络与Web编程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c11/p01_interact_with_http_services_as_client.html">11.1 作为客户端与HTTP服务交互</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p02_creating_tcp_server.html">11.2 创建TCP服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p03_creating_udp_server.html">11.3 创建UDP服务器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p04_generate_range_of_ip_addresses_from_cidr_address.html">11.4 通过CIDR地址生成对应的IP地址集</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p05_creating_simple_rest_based_interface.html">11.5 创建一个简单的REST接口</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p06_implement_simple_remote_procedure_call_with_xml_rpc.html">11.6 通过XML-RPC实现简单的远程调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p07_communicate_simply_between_interpreters.html">11.7 在不同的Python解释器之间交互</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p08_implementing_remote_procedure_calls.html">11.8 实现远程方法调用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p09_authenticating_clients_simply.html">11.9 简单的客户端认证</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p10_add_ssl_to_network_services.html">11.10 在网络服务中加入SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p11_pass_socket_file_descriptor_between_processes.html">11.11 进程间传递Socket文件描述符</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p12_understanding_event_driven_io.html">11.12 理解事件驱动的IO</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c11/p13_sending_receiving_large_arrays.html">11.13 发送与接收大型数组</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p12_concurrency.html">第十二章：并发编程</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of 第十二章：并发编程</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c12/p01_start_stop_thread.html">12.1 启动与停止线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p02_determining_if_thread_has_started.html">12.2 判断线程是否已经启动</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p03_communicating_between_threads.html">12.3 线程间通信</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p04_locking_critical_sections.html">12.4 给关键部分加锁</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p05_locking_with_deadlock_avoidance.html">12.5 防止死锁的加锁机制</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p06_storing_thread_specific_state.html">12.6 保存线程的状态信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p07_creating_thread_pool.html">12.7 创建一个线程池</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p08_perform_simple_parallel_programming.html">12.8 简单的并行编程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p09_dealing_with_gil_stop_worring_about_it.html">12.9 Python的全局锁问题</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p10_defining_an_actor_task.html">12.10 定义一个Actor任务</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p11_implement_publish_subscribe_messaging.html">12.11 实现消息发布/订阅模型</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p12_using_generators_as_alternative_to_threads.html">12.12 使用生成器代替线程</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p13_polling_multiple_thread_queues.html">12.13 多个线程队列轮询</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c12/p14_launching_daemon_process_on_unix.html">12.14 在Unix系统上面启动守护进程</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p13_utility_script_and_system_manage.html">第十三章：脚本编程与系统管理</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of 第十三章：脚本编程与系统管理</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c13/p01_accept_input_via_redirect_pips_or_input_files.html">13.1 通过重定向/管道/文件接受输入</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p02_terminate_program_with_an_error_message.html">13.2 终止程序并给出错误信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p03_parsing_command_line_options.html">13.3 解析命令行选项</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p04_prompt_for_password_at_runtime.html">13.4 运行时弹出密码输入提示</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p05_getting_terminal_size.html">13.5 获取终端的大小</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p06_executing_external_command_and_get_its_output.html">13.6 执行外部命令并获取它的输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p07_copy_move_files_and_directories.html">13.7 复制或者移动文件和目录</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p08_creating_and_unpacking_archives.html">13.8 创建和解压归档文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p09_find_files_by_name.html">13.9 通过文件名查找文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p10_read_configuration_files.html">13.10 读取配置文件</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p11_add_logging_to_simple_scripts.html">13.11 给简单脚本增加日志功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p12_add_logging_to_libraries.html">13.12 给函数库增加日志功能</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p13_making_stopwatch_timer.html">13.13 实现一个计时器</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p14_putting_limits_on_memory_and_cpu_usage.html">13.14 限制内存和CPU的使用量</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c13/p15_luanch_a_web_browser.html">13.15 启动一个WEB浏览器</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p14_test_debug_and_exceptions.html">第十四章：测试、调试和异常</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of 第十四章：测试、调试和异常</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c14/p01_testing_output_sent_to_stdout.html">14.1 测试stdout输出</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p02_patching_objects_in_unit_tests.html">14.2 在单元测试中给对象打补丁</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p03_testing_for_exceptional_conditions_in_unit_tests.html">14.3 在单元测试中测试异常情况</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p04_logging_test_output_to_file.html">14.4 将测试输出用日志记录到文件中</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p05_skip_or_anticipate_test_failures.html">14.5 忽略或期望测试失败</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p06_handle_multiple_exceptions.html">14.6 处理多个异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p07_catching_all_exceptions.html">14.7 捕获所有异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p08_creating_custom_exceptions.html">14.8 创建自定义异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p09_raise_exception_in_response_to_another_exception.html">14.9 捕获异常后抛出另外的异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p10_reraising_the_last_exception.html">14.10 重新抛出被捕获的异常</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p11_issuing_warning_messages.html">14.11 输出警告信息</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p12_debugging_basic_program_crashes.html">14.12 调试基本的程序崩溃错误</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p13_profiling_and_timing_your_program.html">14.13 给你的程序做性能测试</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c14/p14_make_your_program_run_faster.html">14.14 加速程序运行</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../chapters/p15_c_extensions.html">第十五章：C语言扩展</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of 第十五章：C语言扩展</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../c15/p01_access_ccode_using_ctypes.html">15.1 使用ctypes访问C代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p02_write_simple_c_extension_module.html">15.2 简单的C扩展模块</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p03_write_extension_function_operate_on_arrays.html">15.3 编写扩展函数操作数组</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p04_manage_opaque_pointers_in_c_extension_modules.html">15.4 在C扩展模块中操作隐形指针</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p05_define_and_export_c_api_from_extension_modules.html">15.5 从扩展模块中定义和导出C的API</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p06_calling_python_from_c.html">15.6 从C语言中调用Python代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p07_release_the_gil_in_c_extensions.html">15.7 从C扩展中释放全局锁</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p08_mix_threads_from_c_and_python.html">15.8 C和Python中的线程混用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p09_wrap_c_code_with_swig.html">15.9 用SWIG包装C代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p10_wrap_existing_c_code_with_cython.html">15.10 用Cython包装C代码</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p11_use_cython_to_write_high_performance_array_operation.html">15.11 用Cython写高性能的数组操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p12_turning_function_pointer_into_callable.html">15.12 将函数指针转换为可调用对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p13_pass_null_terminated_string_to_c_libraries.html">15.13 传递NULL结尾的字符串给C函数库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p14_pass_unicode_strings_to_c_libraries.html">15.14 传递Unicode字符串给C函数库</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p15_converting_c_string_to_python.html">15.15 C字符串转换为Python字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p16_work_with_c_strings_of_dubious_encoding.html">15.16 不确定编码格式的C字符串</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p17_pass_filenames_to_c_extensions.html">15.17 传递文件名给C扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p18_pass_open_files_to_c_extensions.html">15.18 传递已打开的文件给C扩展</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p19_read_file_like_objects_from_c.html">15.19 从C语言中读取类文件对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p20_consuming_an_iterable_from_c.html">15.20 处理C语言中的可迭代对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../c15/p21_diagnosing_segmentation_faults.html">15.21 诊断分段错误</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../chapters/p16_appendix.html">附录A</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aboutme.html">关于译者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../roadmap.html">Roadmap</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/c10/p11_load_modules_from_remote_machine_by_hooks.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="id1">
<h1>10.11 通过钩子远程加载模块<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h1>
<section id="id2">
<h2>问题<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h2>
<p>你想自定义Python的import语句，使得它能从远程机器上面透明的加载模块。</p>
</section>
<section id="id3">
<h2>解决方案<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>首先要提出来的是安全问题。本节讨论的思想如果没有一些额外的安全和认知机制的话会很糟糕。
也就是说，我们的主要目的是深入分析Python的import语句机制。
如果你理解了本节内部原理，你就能够为其他任何目的而自定义import。
有了这些，让我们继续向前走。</p>
<p>本节核心是设计导入语句的扩展功能。有很多种方法可以做这个，
不过为了演示的方便，我们开始先构造下面这个Python代码结构：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">testcode</span><span class="o">/</span>
    <span class="n">spam</span><span class="o">.</span><span class="n">py</span>
    <span class="n">fib</span><span class="o">.</span><span class="n">py</span>
    <span class="n">grok</span><span class="o">/</span>
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">blah</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>这些文件的内容并不重要，不过我们在每个文件中放入了少量的简单语句和函数，
这样你可以测试它们并查看当它们被导入时的输出。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># spam.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m spam&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hello </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

<span class="c1"># fib.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m fib&quot;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># grok/__init__.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m grok.__init__&quot;</span><span class="p">)</span>

<span class="c1"># grok/blah.py</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I&#39;m grok.blah&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>这里的目的是允许这些文件作为模块被远程访问。
也许最简单的方式就是将它们发布到一个web服务器上面。在testcode目录中像下面这样运行Python：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="o">%</span> <span class="n">cd</span> <span class="n">testcode</span>
<span class="n">bash</span> <span class="o">%</span> <span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="mi">15000</span>
<span class="n">Serving</span> <span class="n">HTTP</span> <span class="n">on</span> <span class="mf">0.0.0.0</span> <span class="n">port</span> <span class="mi">15000</span> <span class="o">...</span>
</pre></div>
</div>
<p>服务器运行起来后再启动一个单独的Python解释器。
确保你可以使用 <code class="docutils literal notranslate"><span class="pre">urllib</span></code> 访问到远程文件。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000/fib.py&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="go"># fib.py</span>
<span class="go">print(&quot;I&#39;m fib&quot;)</span>

<span class="go">def fib(n):</span>
<span class="go">    if n &lt; 2:</span>
<span class="go">        return 1</span>
<span class="go">    else:</span>
<span class="go">        return fib(n-1) + fib(n-2)</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>从这个服务器加载源代码是接下来本节的基础。
为了替代手动的通过 <code class="docutils literal notranslate"><span class="pre">urlopen()</span></code> 来收集源文件，
我们通过自定义import语句来在后台自动帮我们做到。</p>
<p>加载远程模块的第一种方法是创建一个显式的加载函数来完成它。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
    <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>
    <span class="n">code</span> <span class="o">=</span> <span class="nb">compile</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>
    <span class="n">mod</span><span class="o">.</span><span class="vm">__file__</span> <span class="o">=</span> <span class="n">url</span>
    <span class="n">mod</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mod</span>
</pre></div>
</div>
<p>这个函数会下载源代码，并使用 <code class="docutils literal notranslate"><span class="pre">compile()</span></code> 将其编译到一个代码对象中，
然后在一个新创建的模块对象的字典中来执行它。下面是使用这个函数的方式：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000/fib.py&#39;</span><span class="p">)</span>
<span class="go">I&#39;m fib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span><span class="o">.</span><span class="n">fib</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">89</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spam</span> <span class="o">=</span> <span class="n">load_module</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000/spam.py&#39;</span><span class="p">)</span>
<span class="go">I&#39;m spam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spam</span><span class="o">.</span><span class="n">hello</span><span class="p">(</span><span class="s1">&#39;Guido&#39;</span><span class="p">)</span>
<span class="go">Hello Guido</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span>
<span class="go">&lt;module &#39;http://localhost:15000/fib.py&#39; from &#39;http://localhost:15000/fib.py&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">spam</span>
<span class="go">&lt;module &#39;http://localhost:15000/spam.py&#39; from &#39;http://localhost:15000/spam.py&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>正如你所见，对于简单的模块这个是行得通的。
不过它并没有嵌入到通常的import语句中，如果要支持更高级的结构比如包就需要更多的工作了。</p>
<p>一个更酷的做法是创建一个自定义导入器。第一种方法是创建一个元路径导入器。如下：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># urlimport.py</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">importlib.abc</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">urllib.error</span> <span class="kn">import</span> <span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span>
<span class="kn">from</span> <span class="nn">html.parser</span> <span class="kn">import</span> <span class="n">HTMLParser</span>

<span class="c1"># Debugging</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

<span class="c1"># Get links from a given URL</span>
<span class="k">def</span> <span class="nf">_get_links</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">LinkParser</span><span class="p">(</span><span class="n">HTMLParser</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">handle_starttag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">attrs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="s1">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">attrs</span><span class="p">)</span>
                <span class="n">links</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
    <span class="n">links</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Getting links from </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">url</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">LinkParser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">feed</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Could not get links. </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;links: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">links</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">links</span>

<span class="k">class</span> <span class="nc">UrlMetaFinder</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">MetaPathFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">=</span> <span class="n">baseurl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loaders</span> <span class="o">=</span> <span class="p">{</span> <span class="n">baseurl</span> <span class="p">:</span> <span class="n">UrlModuleLoader</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span> <span class="p">}</span>

    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: fullname=</span><span class="si">%r</span><span class="s1">, path=</span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">baseurl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="n">baseurl</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: baseurl=</span><span class="si">%r</span><span class="s1">, basename=</span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">,</span> <span class="n">basename</span><span class="p">)</span>

        <span class="c1"># Check link cache</span>
        <span class="k">if</span> <span class="n">basename</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">[</span><span class="n">baseurl</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_links</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span>

        <span class="c1"># Check if it&#39;s a package</span>
        <span class="k">if</span> <span class="n">basename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">[</span><span class="n">baseurl</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: trying package </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="n">fullurl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">basename</span>
            <span class="c1"># Attempt to load the package (which accesses __init__.py)</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">UrlPackageLoader</span><span class="p">(</span><span class="n">fullurl</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">[</span><span class="n">fullurl</span><span class="p">]</span> <span class="o">=</span> <span class="n">_get_links</span><span class="p">(</span><span class="n">fullurl</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_loaders</span><span class="p">[</span><span class="n">fullurl</span><span class="p">]</span> <span class="o">=</span> <span class="n">UrlModuleLoader</span><span class="p">(</span><span class="n">fullurl</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: package </span><span class="si">%r</span><span class="s1"> loaded&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: package failed. </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">loader</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">loader</span>
        <span class="c1"># A normal module</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">[</span><span class="n">baseurl</span><span class="p">]:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: module </span><span class="si">%r</span><span class="s1"> found&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaders</span><span class="p">[</span><span class="n">baseurl</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_module: module </span><span class="si">%r</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">invalidate_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;invalidating link cache&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c1"># Module Loader for a URL</span>
<span class="k">class</span> <span class="nc">UrlModuleLoader</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">SourceLoader</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">=</span> <span class="n">baseurl</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_source_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">module_repr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;&lt;urlmodule </span><span class="si">%r</span><span class="s1"> from </span><span class="si">%r</span><span class="s1">&gt;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">module</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>

    <span class="c1"># Required method</span>
    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_code</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">fullname</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">))</span>
        <span class="n">mod</span><span class="o">.</span><span class="vm">__file__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">__loader__</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">rpartition</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">mod</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mod</span>

    <span class="c1"># Optional extensions</span>
    <span class="k">def</span> <span class="nf">get_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="n">src</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_source</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">compile</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">fullname</span><span class="p">),</span> <span class="s1">&#39;exec&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">fullname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>

    <span class="k">def</span> <span class="nf">get_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_filename</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loader: reading </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_cache</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loader: cached </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_source_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loader: </span><span class="si">%r</span><span class="s1"> loaded&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_source_cache</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>
            <span class="k">return</span> <span class="n">source</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">HTTPError</span><span class="p">,</span> <span class="n">URLError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;loader: </span><span class="si">%r</span><span class="s1"> failed. </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t load </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Package loader for a URL</span>
<span class="k">class</span> <span class="nc">UrlPackageLoader</span><span class="p">(</span><span class="n">UrlModuleLoader</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">load_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="n">mod</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">__path__</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="p">]</span>
        <span class="n">mod</span><span class="o">.</span><span class="n">__package__</span> <span class="o">=</span> <span class="n">fullname</span>

    <span class="k">def</span> <span class="nf">get_filename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;__init__.py&#39;</span>

    <span class="k">def</span> <span class="nf">is_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Utility functions for installing/uninstalling the loader</span>
<span class="n">_installed_meta_cache</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
<span class="k">def</span> <span class="nf">install_meta</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">address</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_installed_meta_cache</span><span class="p">:</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="n">UrlMetaFinder</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">_installed_meta_cache</span><span class="p">[</span><span class="n">address</span><span class="p">]</span> <span class="o">=</span> <span class="n">finder</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">finder</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> installed on sys.meta_path&#39;</span><span class="p">,</span> <span class="n">finder</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">remove_meta</span><span class="p">(</span><span class="n">address</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">address</span> <span class="ow">in</span> <span class="n">_installed_meta_cache</span><span class="p">:</span>
        <span class="n">finder</span> <span class="o">=</span> <span class="n">_installed_meta_cache</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">finder</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%r</span><span class="s1"> removed from sys.meta_path&#39;</span><span class="p">,</span> <span class="n">finder</span><span class="p">)</span>
</pre></div>
</div>
<p>下面是一个交互会话，演示了如何使用前面的代码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># importing currently fails</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load the importer and retry (it works)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlimport</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlimport</span><span class="o">.</span><span class="n">install_meta</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">I&#39;m fib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">spam</span>
<span class="go">I&#39;m spam</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">grok.blah</span>
<span class="go">I&#39;m grok.__init__</span>
<span class="go">I&#39;m grok.blah</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grok</span><span class="o">.</span><span class="n">blah</span><span class="o">.</span><span class="vm">__file__</span>
<span class="go">&#39;http://localhost:15000/grok/blah.py&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>这个特殊的方案会安装一个特别的查找器 <code class="docutils literal notranslate"><span class="pre">UrlMetaFinder</span></code> 实例，
作为 <code class="docutils literal notranslate"><span class="pre">sys.meta_path</span></code> 中最后的实体。
当模块被导入时，会依据 <code class="docutils literal notranslate"><span class="pre">sys.meta_path</span></code> 中的查找器定位模块。
在这个例子中，<code class="docutils literal notranslate"><span class="pre">UrlMetaFinder</span></code> 实例是最后一个查找器方案，
当模块在任何一个普通地方都找不到的时候就触发它。</p>
<p>作为常见的实现方案，<code class="docutils literal notranslate"><span class="pre">UrlMetaFinder</span></code> 类包装在一个用户指定的URL上。
在内部，查找器通过抓取指定URL的内容构建合法的链接集合。
导入的时候，模块名会跟已有的链接作对比。如果找到了一个匹配的，
一个单独的 <code class="docutils literal notranslate"><span class="pre">UrlModuleLoader</span></code> 类被用来从远程机器上加载源代码并创建最终的模块对象。
这里缓存链接的一个原因是避免不必要的HTTP请求重复导入。</p>
<p>自定义导入的第二种方法是编写一个钩子直接嵌入到 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 变量中去，
识别某些目录命名模式。
在 <code class="docutils literal notranslate"><span class="pre">urlimport.py</span></code> 中添加如下的类和支持函数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># urlimport.py</span>
<span class="c1"># ... include previous code above ...</span>
<span class="c1"># Path finder class for a URL</span>
<span class="k">class</span> <span class="nc">UrlPathFinder</span><span class="p">(</span><span class="n">importlib</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">PathEntryFinder</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">baseurl</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loader</span> <span class="o">=</span> <span class="n">UrlModuleLoader</span><span class="p">(</span><span class="n">baseurl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">=</span> <span class="n">baseurl</span>

    <span class="k">def</span> <span class="nf">find_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">fullname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># Check link cache</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># See discussion</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="n">_get_links</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span><span class="p">)</span>

        <span class="c1"># Check if it&#39;s a package</span>
        <span class="k">if</span> <span class="n">basename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: trying package </span><span class="si">%r</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="n">fullurl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="n">basename</span>
            <span class="c1"># Attempt to load the package (which accesses __init__.py)</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">UrlPackageLoader</span><span class="p">(</span><span class="n">fullurl</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">loader</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: package </span><span class="si">%r</span><span class="s1"> loaded&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: </span><span class="si">%r</span><span class="s1"> is a namespace package&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
                <span class="n">loader</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="p">[</span><span class="n">fullurl</span><span class="p">])</span>

        <span class="c1"># A normal module</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span> <span class="o">+</span> <span class="s1">&#39;.py&#39;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: module </span><span class="si">%r</span><span class="s1"> found&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loader</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;find_loader: module </span><span class="si">%r</span><span class="s1"> not found&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">invalidate_caches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;invalidating link cache&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Check path to see if it looks like a URL</span>
<span class="n">_url_path_cache</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">def</span> <span class="nf">handle_url</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">((</span><span class="s1">&#39;http://&#39;</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">)):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Handle path? </span><span class="si">%s</span><span class="s1">. [Yes]&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">_url_path_cache</span><span class="p">:</span>
            <span class="n">finder</span> <span class="o">=</span> <span class="n">_url_path_cache</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">finder</span> <span class="o">=</span> <span class="n">UrlPathFinder</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">_url_path_cache</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">finder</span>
        <span class="k">return</span> <span class="n">finder</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Handle path? </span><span class="si">%s</span><span class="s1">. [No]&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">install_path_hook</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path_hooks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">handle_url</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Installing handle_url&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">remove_path_hook</span><span class="p">():</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path_hooks</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">handle_url</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Removing handle_url&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>要使用这个路径查找器，你只需要在 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中加入URL链接。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Initial import fails</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Install the path hook</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlimport</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlimport</span><span class="o">.</span><span class="n">install_path_hook</span><span class="p">()</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Imports still fail (not on path)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add an entry to sys.path and watch it work</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">I&#39;m fib</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">grok.blah</span>
<span class="go">I&#39;m grok.__init__</span>
<span class="go">I&#39;m grok.blah</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">grok</span><span class="o">.</span><span class="n">blah</span><span class="o">.</span><span class="vm">__file__</span>
<span class="go">&#39;http://localhost:15000/grok/blah.py&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>关键点就是 <code class="docutils literal notranslate"><span class="pre">handle_url()</span></code> 函数，它被添加到了 <code class="docutils literal notranslate"><span class="pre">sys.path_hooks</span></code> 变量中。
当 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 的实体被处理时，会调用 <code class="docutils literal notranslate"><span class="pre">sys.path_hooks</span></code> 中的函数。
如果任何一个函数返回了一个查找器对象，那么这个对象就被用来为 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 实体加载模块。</p>
<p>远程模块加载跟其他的加载使用方法几乎是一样的。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span>
<span class="go">&lt;urlmodule &#39;fib&#39; from &#39;http://localhost:15000/fib.py&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;fib&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fib</span><span class="o">.</span><span class="vm">__file__</span>
<span class="go">&#39;http://localhost:15000/fib.py&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">inspect</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">inspect</span><span class="o">.</span><span class="n">getsource</span><span class="p">(</span><span class="n">fib</span><span class="p">))</span>
<span class="go"># fib.py</span>
<span class="go">print(&quot;I&#39;m fib&quot;)</span>

<span class="go">def fib(n):</span>
<span class="go">    if n &lt; 2:</span>
<span class="go">        return 1</span>
<span class="go">    else:</span>
<span class="go">        return fib(n-1) + fib(n-2)</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>讨论<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>在详细讨论之前，有点要强调的是，Python的模块、包和导入机制是整个语言中最复杂的部分，
即使经验丰富的Python程序员也很少能精通它们。
我在这里推荐一些值的去读的文档和书籍，包括
<a class="reference external" href="https://docs.python.org/3/library/importlib.html">importlib module</a>
和 <a class="reference external" href="http://www.python.org/dev/peps/pep-0302">PEP 302</a>.
文档内容在这里不会被重复提到，不过我在这里会讨论一些最重要的部分。</p>
<p>首先，如果你想创建一个新的模块对象，使用 <code class="docutils literal notranslate"><span class="pre">imp.new_module()</span></code> 函数：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">imp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;module &#39;spam&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="vm">__name__</span>
<span class="go">&#39;spam&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>模块对象通常有一些期望属性，包括 <code class="docutils literal notranslate"><span class="pre">__file__</span></code> （运行模块加载语句的文件名）
和 <code class="docutils literal notranslate"><span class="pre">__package__</span></code> (包名)。</p>
<p>其次，模块会被解释器缓存起来。模块缓存可以在字典 <code class="docutils literal notranslate"><span class="pre">sys.modules</span></code> 中被找到。
因为有了这个缓存机制，通常可以将缓存和模块的创建通过一个步骤完成：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">imp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;module &#39;spam&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>如果给定模块已经存在那么就会直接获得已经被创建过的模块，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;math&#39;</span><span class="p">,</span> <span class="n">imp</span><span class="o">.</span><span class="n">new_module</span><span class="p">(</span><span class="s1">&#39;math&#39;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;module &#39;math&#39; from &#39;/usr/local/lib/python3.3/lib-dynload/math.so&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">0.9092974268256817</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="go">-0.4161468365471424</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>由于创建模块很简单，很容易编写简单函数比如第一部分的 <code class="docutils literal notranslate"><span class="pre">load_module()</span></code> 函数。
这个方案的一个缺点是很难处理复杂情况比如包的导入。
为了处理一个包，你要重新实现普通import语句的底层逻辑（比如检查目录，查找__init__.py文件，
执行那些文件，设置路径等）。这个复杂性就是为什么最好直接扩展import语句而不是自定义函数的一个原因。</p>
<p>扩展import语句很简单，但是会有很多移动操作。
最高层上，导入操作被一个位于sys.meta_path列表中的“元路径”查找器处理。
如果你输出它的值，会看到下面这样：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="p">)</span>
<span class="go">[&lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;,</span>
<span class="go">&lt;class &#39;_frozen_importlib.FrozenImporter&#39;&gt;,</span>
<span class="go">&lt;class &#39;_frozen_importlib.PathFinder&#39;&gt;]</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>当执行一个语句比如 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">fib</span></code> 时，解释器会遍历sys.mata_path中的查找器对象，
调用它们的 <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> 方法定位正确的模块加载器。
可以通过实验来看看：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Finder</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">find_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Looking for&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="kc">None</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Finder</span><span class="p">())</span> <span class="c1"># Insert as first entry</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">math</span>
<span class="go">Looking for math None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">types</span>
<span class="go">Looking for types None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">threading</span>
<span class="go">Looking for threading None</span>
<span class="go">Looking for time None</span>
<span class="go">Looking for traceback None</span>
<span class="go">Looking for linecache None</span>
<span class="go">Looking for tokenize None</span>
<span class="go">Looking for token None</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>注意看 <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> 方法是怎样在每一个导入就被触发的。
这个方法中的path参数的作用是处理包。
多个包被导入，就是一个可在包的 <code class="docutils literal notranslate"><span class="pre">__path__</span></code> 属性中找到的路径列表。
要找到包的子组件就要检查这些路径。
比如注意对于 <code class="docutils literal notranslate"><span class="pre">xml.etree</span></code> 和 <code class="docutils literal notranslate"><span class="pre">xml.etree.ElementTree</span></code> 的路径配置：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span>
<span class="go">Looking for xml None</span>
<span class="go">Looking for xml.etree [&#39;/usr/local/lib/python3.3/xml&#39;]</span>
<span class="go">Looking for xml.etree.ElementTree [&#39;/usr/local/lib/python3.3/xml/etree&#39;]</span>
<span class="go">Looking for warnings None</span>
<span class="go">Looking for contextlib None</span>
<span class="go">Looking for xml.etree.ElementPath [&#39;/usr/local/lib/python3.3/xml/etree&#39;]</span>
<span class="go">Looking for _elementtree None</span>
<span class="go">Looking for copy None</span>
<span class="go">Looking for org None</span>
<span class="go">Looking for pyexpat None</span>
<span class="go">Looking for ElementC14N None</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">sys.meta_path</span></code> 上查找器的位置很重要，将它从队头移到队尾，然后再试试导入看：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">meta_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Finder</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
</pre></div>
</div>
<p>现在你看不到任何输出了，因为导入被sys.meta_path中的其他实体处理。
这时候，你只有在导入不存在模块的时候才能看到它被触发：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">Looking for fib None</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">xml.superfast</span>
<span class="go">Looking for xml.superfast [&#39;/usr/local/lib/python3.3/xml&#39;]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;xml.superfast&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>你之前安装过一个捕获未知模块的查找器，这个是 <code class="docutils literal notranslate"><span class="pre">UrlMetaFinder</span></code> 类的关键。
一个 <code class="docutils literal notranslate"><span class="pre">UrlMetaFinder</span></code> 实例被添加到 <code class="docutils literal notranslate"><span class="pre">sys.meta_path</span></code> 的末尾，作为最后一个查找器方案。
如果被请求的模块名不能定位，就会被这个查找器处理掉。
处理包的时候需要注意，在path参数中指定的值需要被检查，看它是否以查找器中注册的URL开头。
如果不是，该子模块必须归属于其他查找器并被忽略掉。</p>
<p>对于包的其他处理可在 <code class="docutils literal notranslate"><span class="pre">UrlPackageLoader</span></code> 类中被找到。
这个类不会导入包名，而是去加载对应的 <code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> 文件。
它也会设置模块的 <code class="docutils literal notranslate"><span class="pre">__path__</span></code> 属性，这一步很重要，
因为在加载包的子模块时这个值会被传给后面的 <code class="docutils literal notranslate"><span class="pre">find_module()</span></code> 调用。
基于路径的导入钩子是这些思想的一个扩展，但是采用了另外的方法。
我们都知道，<code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 是一个Python查找模块的目录列表，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
<span class="go">[&#39;&#39;,</span>
<span class="go">&#39;/usr/local/lib/python33.zip&#39;,</span>
<span class="go">&#39;/usr/local/lib/python3.3&#39;,</span>
<span class="go">&#39;/usr/local/lib/python3.3/plat-darwin&#39;,</span>
<span class="go">&#39;/usr/local/lib/python3.3/lib-dynload&#39;,</span>
<span class="go">&#39;/usr/local/lib/...3.3/site-packages&#39;]</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中的每一个实体都会被额外的绑定到一个查找器对象上。
你可以通过查看 <code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code> 去看下这些查找器：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="p">)</span>
<span class="go">{&#39;.&#39;: FileFinder(&#39;.&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3&#39;: FileFinder(&#39;/usr/local/lib/python3.3&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/&#39;: FileFinder(&#39;/usr/local/lib/python3.3/&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/collections&#39;: FileFinder(&#39;...python3.3/collections&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/encodings&#39;: FileFinder(&#39;...python3.3/encodings&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/lib-dynload&#39;: FileFinder(&#39;...python3.3/lib-dynload&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/plat-darwin&#39;: FileFinder(&#39;...python3.3/plat-darwin&#39;),</span>
<span class="go">&#39;/usr/local/lib/python3.3/site-packages&#39;: FileFinder(&#39;...python3.3/site-packages&#39;),</span>
<span class="go">&#39;/usr/local/lib/python33.zip&#39;: None}</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code> 比 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 会更大点，
因为它会为所有被加载代码的目录记录它们的查找器。
这包括包的子目录，这些通常在 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中是不存在的。</p>
<p>要执行 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">fib</span></code> ，会顺序检查 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中的目录。
对于每个目录，名称“fib”会被传给相应的 <code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code> 中的查找器。
这个可以让你创建自己的查找器并在缓存中放入一个实体。试试这个：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Finder</span><span class="p">:</span>
<span class="gp">... </span><span class="k">def</span> <span class="nf">find_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Looking for&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">return</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">[])</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add a &quot;debug&quot; entry to the importer cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="p">[</span><span class="s1">&#39;debug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Finder</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Add a &quot;debug&quot; directory to sys.path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;debug&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">threading</span>
<span class="go">Looking for threading</span>
<span class="go">Looking for time</span>
<span class="go">Looking for traceback</span>
<span class="go">Looking for linecache</span>
<span class="go">Looking for tokenize</span>
<span class="go">Looking for token</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>在这里，你可以为名字“debug”创建一个新的缓存实体并将它设置成 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 上的第一个。
在所有接下来的导入中，你会看到你的查找器被触发了。
不过，由于它返回 (None, [])，那么处理进程会继续处理下一个实体。</p>
<p><code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code> 的使用被一个存储在 <code class="docutils literal notranslate"><span class="pre">sys.path_hooks</span></code> 中的函数列表控制。
试试下面的例子，它会清除缓存并给 <code class="docutils literal notranslate"><span class="pre">sys.path_hooks</span></code> 添加一个新的路径检查函数</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Checking&#39;</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path_hooks</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">check_path</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">Checked debug</span>
<span class="go">Checking .</span>
<span class="go">Checking /usr/local/lib/python33.zip</span>
<span class="go">Checking /usr/local/lib/python3.3</span>
<span class="go">Checking /usr/local/lib/python3.3/plat-darwin</span>
<span class="go">Checking /usr/local/lib/python3.3/lib-dynload</span>
<span class="go">Checking /Users/beazley/.local/lib/python3.3/site-packages</span>
<span class="go">Checking /usr/local/lib/python3.3/site-packages</span>
<span class="go">Looking for fib</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>正如你所见，<code class="docutils literal notranslate"><span class="pre">check_path()</span></code> 函数被每个 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 中的实体调用。
不顾，由于抛出了 <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> 异常，
啥都不会发生了（仅仅将检查转移到sys.path_hooks的下一个函数）。</p>
<p>知道了怎样sys.path是怎样被处理的，你就能构建一个自定义路径检查函数来查找文件名，不然URL。例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">check_url</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;http://&#39;</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="n">Finder</span><span class="p">()</span>
<span class="gp">... </span>    <span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">()</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path_hooks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">Looking for fib # Finder output!</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="n">File</span> <span class="s2">&quot;&lt;stdin&gt;&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">1</span><span class="p">,</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Notice installation of Finder in sys.path_importer_cache</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path_importer_cache</span><span class="p">[</span><span class="s1">&#39;http://localhost:15000&#39;</span><span class="p">]</span>
<span class="go">&lt;__main__.Finder object at 0x10064c850&gt;</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>这就是本节最后部分的关键点。事实上，一个用来在sys.path中查找URL的自定义路径检查函数已经构建完毕。
当它们被碰到的时候，一个新的 <code class="docutils literal notranslate"><span class="pre">UrlPathFinder</span></code> 实例被创建并被放入 <code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code>.
之后，所有需要检查 <code class="docutils literal notranslate"><span class="pre">sys.path</span></code> 的导入语句都会使用你的自定义查找器。</p>
<p>基于路径导入的包处理稍微有点复杂，并且跟 <code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 方法返回值有关。
对于简单模块，<code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 返回一个元组(loader, None)，
其中的loader是一个用于导入模块的加载器实例。</p>
<p>对于一个普通的包，<code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 返回一个元组(loader, path)，
其中的loader是一个用于导入包（并执行__init__.py）的加载器实例，
path是一个会初始化包的 <code class="docutils literal notranslate"><span class="pre">__path__</span></code> 属性的目录列表。
例如，如果基础URL是 <a class="reference external" href="http://localhost:15000">http://localhost:15000</a> 并且一个用户执行 <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">grok</span></code> ,
那么 <code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 返回的path就会是 [ ‘<a class="reference external" href="http://localhost:15000/grok">http://localhost:15000/grok</a>’ ]</p>
<p><code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 还要能处理一个命名空间包。
一个命名空间包中有一个合法的包目录名，但是不存在__init__.py文件。
这样的话，<code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 必须返回一个元组(None, path)，
path是一个目录列表，由它来构建包的定义有__init__.py文件的__path__属性。
对于这种情况，导入机制会继续前行去检查sys.path中的目录。
如果找到了命名空间包，所有的结果路径被加到一起来构建最终的命名空间包。
关于命名空间包的更多信息请参考10.5小节。</p>
<p>所有的包都包含了一个内部路径设置，可以在__path__属性中看到，例如：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xml</span><span class="o">.</span><span class="n">__path__</span>
<span class="go">[&#39;/usr/local/lib/python3.3/xml&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">xml</span><span class="o">.</span><span class="n">etree</span><span class="o">.</span><span class="n">__path__</span>
<span class="go">[&#39;/usr/local/lib/python3.3/xml/etree&#39;]</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>之前提到，__path__的设置是通过 <code class="docutils literal notranslate"><span class="pre">find_loader()</span></code> 方法返回值控制的。
不过，__path__接下来也被sys.path_hooks中的函数处理。
因此，但包的子组件被加载后，位于__path__中的实体会被 <code class="docutils literal notranslate"><span class="pre">handle_url()</span></code> 函数检查。
这会导致新的 <code class="docutils literal notranslate"><span class="pre">UrlPathFinder</span></code> 实例被创建并且被加入到 <code class="docutils literal notranslate"><span class="pre">sys.path_importer_cache</span></code> 中。</p>
<p>还有个难点就是 <code class="docutils literal notranslate"><span class="pre">handle_url()</span></code> 函数以及它跟内部使用的 <code class="docutils literal notranslate"><span class="pre">_get_links()</span></code> 函数之间的交互。
如果你的查找器实现需要使用到其他模块（比如urllib.request），
有可能这些模块会在查找器操作期间进行更多的导入。
它可以导致 <code class="docutils literal notranslate"><span class="pre">handle_url()</span></code> 和其他查找器部分陷入一种递归循环状态。
为了解释这种可能性，实现中有一个被创建的查找器缓存（每一个URL一个）。
它可以避免创建重复查找器的问题。
另外，下面的代码片段可以确保查找器不会在初始化链接集合的时候响应任何导入请求：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Check link cache</span>
<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># See discussion</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_links</span> <span class="o">=</span> <span class="n">_get_links</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baseurl</span><span class="p">)</span>
</pre></div>
</div>
<p>最后，查找器的 <code class="docutils literal notranslate"><span class="pre">invalidate_caches()</span></code> 方法是一个工具方法，用来清理内部缓存。
这个方法再用户调用 <code class="docutils literal notranslate"><span class="pre">importlib.invalidate_caches()</span></code> 的时候被触发。
如果你想让URL导入者重新读取链接列表的话可以使用它。</p>
<p>对比下两种方案（修改sys.meta_path或使用一个路径钩子）。
使用sys.meta_path的导入者可以按照自己的需要自由处理模块。
例如，它们可以从数据库中导入或以不同于一般模块/包处理方式导入。
这种自由同样意味着导入者需要自己进行内部的一些管理。
另外，基于路径的钩子只是适用于对sys.path的处理。
通过这种扩展加载的模块跟普通方式加载的特性是一样的。</p>
<p>如果到现在为止你还是不是很明白，那么可以通过增加一些日志打印来测试下本节。像下面这样：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">logging</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlimport</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlimport</span><span class="o">.</span><span class="n">install_path_hook</span><span class="p">()</span>
<span class="go">DEBUG:urlimport:Installing handle_url</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">DEBUG:urlimport:Handle path? /usr/local/lib/python33.zip. [No]</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="gr">File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;</span>
<span class="gr">ImportError</span>: <span class="n">No module named &#39;fib&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;http://localhost:15000&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">fib</span>
<span class="go">DEBUG:urlimport:Handle path? http://localhost:15000. [Yes]</span>
<span class="go">DEBUG:urlimport:Getting links from http://localhost:15000</span>
<span class="go">DEBUG:urlimport:links: {&#39;spam.py&#39;, &#39;fib.py&#39;, &#39;grok&#39;}</span>
<span class="go">DEBUG:urlimport:find_loader: &#39;fib&#39;</span>
<span class="go">DEBUG:urlimport:find_loader: module &#39;fib&#39; found</span>
<span class="go">DEBUG:urlimport:loader: reading &#39;http://localhost:15000/fib.py&#39;</span>
<span class="go">DEBUG:urlimport:loader: &#39;http://localhost:15000/fib.py&#39; loaded</span>
<span class="go">I&#39;m fib</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>最后，建议你花点时间看看 <a class="reference external" href="http://www.python.org/dev/peps/pep-0302">PEP 302</a>
以及importlib的文档。</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="p12_patching_modules_on_import.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">10.12 导入模块的同时修改模块</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="p10_import_modules_using_name_given_in_string.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">10.10 通过字符串名导入模块</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                <a href="../copyright.html">Copyright</a> &#169; 2017, 熊能
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">10.11 通过钩子远程加载模块</a><ul>
<li><a class="reference internal" href="#id2">问题</a></li>
<li><a class="reference internal" href="#id3">解决方案</a></li>
<li><a class="reference internal" href="#id4">讨论</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=cd91d057"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>